<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head>
	<title>Facelets Hello World</title>
</h:head>
<h:body>
	<h:form id="content">
		<h:panelGrid columns="2" cellpadding="5">
			<p:outputLabel for="endpoint" value="Endpoint:"
				style="font-weight:bold" />
			<p:inputTextarea id="endpoint" rows="1" cols="150"
				value="#{sparqlController.endpoint}" />
			<p:outputLabel for="query" value="Query:" style="font-weight:bold" />
			<p:inputTextarea id="query" rows="10" cols="150"
				value="#{sparqlController.queryStr}" />
			<p:spacer />
			<h:panelGrid columns="2" cellpadding="5">
				<p:commandButton value="Search"
					actionListener="#{sparqlController.query()}" update="@form"
					icon="ui-icon-search">
				</p:commandButton>

				<p:commandButton value="Download" ajax="false"
					onclick="PrimeFaces.monitorDownload(start, stop);"
					icon="ui-icon-disk">
					<p:fileDownload value="#{sparqlController.save()}" />
				</p:commandButton>
			</h:panelGrid>
		</h:panelGrid>
		<p />
		<hr />
		<p />
		<c:if test="#{sparqlController.isTable()}">

			<p:tabView>
				<p:tab title="Table">
					<p:messages id="messages" showDetail="true" autoUpdate="true"
						closable="true" />

					<p:dataTable id="tbl" var="result"
						value="#{sparqlController.results}" paginator="true" rows="20">

						<p:columns value="#{sparqlController.header}" var="column"
							columnIndexVar="colIndex">
							<f:facet name="header">
								<p:outputPanel>
                                #{column}
                            </p:outputPanel>
							</f:facet>
							<h:outputText value="#{result.get(colIndex)}" />
							<br />
						</p:columns>



					</p:dataTable>

				</p:tab>
				<p:tab title="Graphs">
					<h:panelGrid columns="7" cellpadding="5">
						<p:outputLabel value="Group:" for="group" />
						<p:selectOneMenu id="group" value="#{sparqlController.barGroup}"
							style="width:125px">
							<f:selectItem itemLabel="Select One" itemValue="" />
							<f:selectItems value="#{sparqlController.header}" />
						</p:selectOneMenu>
						<p:outputLabel value="Set X:" for="set" />
						<p:selectOneMenu id="set" value="#{sparqlController.barSet}"
							style="width:125px">
							<f:selectItem itemLabel="Select One" itemValue="" />
							<f:selectItems value="#{sparqlController.header}" />
						</p:selectOneMenu>
						<p:outputLabel value="Set Y:" for="data" />
						<p:selectOneMenu id="data" value="#{sparqlController.barData}"
							style="width:125px">
							<f:selectItem itemLabel="Select One" itemValue="" />
							<f:selectItems value="#{sparqlController.header}" />
						</p:selectOneMenu>
						<p:commandButton value="Create BarChart"
							actionListener="#{sparqlController.initBar()}" update="@form" />
					</h:panelGrid>
					<hr />
					<p:chart type="bar" model="#{sparqlController.asBar()}"
						legendPosition="ne" widgetVar="chart" />
					<p:commandButton type="button" value="Export"
						icon="ui-icon-extlink" onclick="exportChart()" />

					<p:dialog widgetVar="dlg2" showEffect="fade" modal="true"
						header="Chart as an Image" resizable="false">
						<p:outputPanel id="output2" layout="block"
							style="width:500px;height:300px" />
					</p:dialog>
				</p:tab>
			</p:tabView>
		</c:if>
		<c:if test="#{!sparqlController.isTable()}">
			<h:outputText id="none_select_results"
				value="#{sparqlController.resultAsText}" />
		</c:if>

	</h:form>
	<script type="text/javascript">
		function start() {
			PF('statusDialog').show();
		}

		function stop() {
			PF('statusDialog').hide();
		}
	</script>
	<script type="text/javascript">
		function exportChart() {
			//export image
			$('#output2').empty().append(PF('chart').exportAsImage());

			//show the dialog
			PF('dlg2').show();
		}
	</script>
</h:body>
</html>